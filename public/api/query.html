<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <!-- Basic -->
    <title>Query | Grapher Docs</title>
    <meta name="description" content="Reference API for Grapher Query">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="../images/favicon.png"
          sizes="16x16 32x32 64x64">

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://grapher.cultofcoders.com">
    <meta property="og:title" content="Query | Grapher Docs">
    <meta property="og:description" content="Reference API for Grapher Query">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_image_large">
    <meta name="twitter:site" content="@culotfcoders">
    <meta name="twitter:title" content="Query | Grapher Docs">
    <meta name="twitter:description" content="Reference API for Grapher Query">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content=""/>
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic'
          rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/style/style.css">
</head>
<body class="">


<div class="nav dark">
  <div class="nav-group">
    <div class="nav-item">
      <span class="js-sidebar-toggle show-mobile">
        <span class="icon-menu"></span>
      </span>
      <a class="logo show-desktop" href="http://www.cultofcoders.com" title="Grapher"  >
        <img src="../images/logo.png" alt="Grapher Docs"/>
        <span></span>
      </a>
    </div>
  </div>

  <div class="center-wrapper show-mobile">
    <img src="../images/logo.png" alt="Grapher Docs"/>
    <div></div>
  </div>

  <div class="nav-group right">
    
      <div class="nav-item show-mobile">
        <span class="js-search-toggle">
          <span class="icon-search"></span>
        </span>
      </div>
    
    
      <div class="nav-item show-desktop ">
        <a class="link" href="https://github.com/cult-of-coders/grapher" target=_new >
          <span>GitHub</span>
        </a>
      </div>
    
      <div class="nav-item show-desktop ">
        <a class="link" href="http://grapher-live.cultofcoders.com/grapher" target=_new >
          <span>Test Live</span>
        </a>
      </div>
    
  </div>

  
    <div class="nav-search">
      <div class="input-symbol">
        <input type="text" placeholder="Search " id="mobile-search-input"/>
        <span class="icon-search"></span>
      </div>

      <div class="nav-group right">
        <div class="nav-item">
          <span class="js-search-toggle">
            <span class="icon-close"></span>
          </span>
        </div>
      </div>

      <div class="wrapper-mobile-search-results"></div>
    </div>
  

</div>

<div class="sidebar">
  <div class="panel">
    <div class="panel-item">
      <a class="" href="http://www.cultofcoders.com" title="Grapher"  >
        <span>Grapher</span>
      </a>
    </div>
    
      <div class="panel-item "">
        <a class="" href="https://github.com/cult-of-coders/grapher" target=_new >
          <span>GitHub</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://grapher-live.cultofcoders.com/grapher" target=_new >
          <span>Test Live</span>
        </a>
      </div>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      <span class="title-sidebar">Grapher Docs</span>
      
    </div>

    
    <div class="wrapper-search">
      <div class="input-symbol small round">
        <input type="text" placeholder="Search " id="desktop-search-input" />
        <span class="icon-search"></span>
      </div>
      <div class="wrapper-desktop-search-results"></div>
    </div>

    

    <ul class="toc">
      
        <li>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="../index.html" class="sidebar-link ">
                  <span>Introduction</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">API</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="links.html" class="sidebar-link ">
                  <span>Linking</span>
                </a>
              </li>
            
              
              <li class="item-toc  current">
                <a href="" class="sidebar-link  current">
                  <span>Query</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="exposure.html" class="sidebar-link ">
                  <span>Exposure API</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="namedQuery.html" class="sidebar-link ">
                  <span>Named Query</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Guide</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="../guide/links.html" class="sidebar-link ">
                  <span>Managing Links</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../guide/query.html" class="sidebar-link ">
                  <span>Using Query</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../guide/exposure.html" class="sidebar-link ">
                  <span>Exposing Collections</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../guide/namedQuery.html" class="sidebar-link ">
                  <span>Using Named Query</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Packages</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="../packages/live.html" class="sidebar-link ">
                  <span>Grapher Live</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../packages/boilerplate.html" class="sidebar-link ">
                  <span>Grapher Boilerplate</span>
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>
</div>

<div class="content">
  <div class="content-wrapper">
    <div class="header-content">
      <h1 class="title-page">Query</h1>
      
        <div class="subtitle-page">Reference API for Grapher Query</div>
      

      <div class="page-actions">
        <div class="actions-group">
          <a class="btn primary small round lowercase" href="https://github.com/cult-of-coders/grapher-docs/tree/master/source/api/query.md" target="_blank"><span class="icon-github"></span> <span>Edit on GitHub</span></a>
          
        </div>
      </div>
    </div>

    <div class="document-formatting">
      <h2 id="Collection-createQuery"><a href="#Collection-createQuery" class="headerlink" title="Collection.createQuery()"></a>Collection.createQuery()</h2><p>Available $filters: <a href="http://docs.meteor.com/api/collections.html#selectors" target="_blank" rel="external">http://docs.meteor.com/api/collections.html#selectors</a></p>
<p>Available $options: <em>sort</em>, <em>skip</em> and <em>limit</em> </p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">const query = Posts.createQuery(&#123;</div><div class="line">    <span class="symbol">$</span>filters: &#123;&#125;,</div><div class="line">    <span class="symbol">$</span><span class="keyword">options</span>: &#123;&#125;,</div><div class="line">    <span class="symbol">$</span>filter(&#123;filters, <span class="keyword">options</span>, params&#125;) &#123;</div><div class="line">        <span class="comment">// modify filters and options don't override</span></div><div class="line">    &#125;</div><div class="line">    title: <span class="number">1</span>,</div><div class="line">    nestedField: &#123; <span class="comment">// &#123;&#125; can be used for nested fields</span></div><div class="line">        nestedFieldItem: <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">    comments: &#123;</div><div class="line">        <span class="symbol">$</span>filters: &#123;&#125;, <span class="comment">// will only be applied to linked elements</span></div><div class="line">        <span class="symbol">$</span><span class="keyword">options</span>: &#123;&#125;, <span class="comment">// will only be applied to linked elements</span></div><div class="line">        <span class="symbol">$</span>filter(&#123;filters, <span class="keyword">options</span>, params&#125;) &#123;</div><div class="line">            <span class="comment">// params is global at query level, so params here are the same as params from the parent</span></div><div class="line">        &#125;</div><div class="line">        linkField: <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">&#125;, params)</div></pre></td></tr></table></figure>
<h2 id="createQuery"><a href="#createQuery" class="headerlink" title="createQuery()"></a>createQuery()</h2><figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">import &#123; createQuery &#125; from <span class="string">'meteor/cultofcoders:grapher'</span>;</div><div class="line"></div><div class="line">const query = createQuery(&#123;</div><div class="line">    posts: &#123;</div><div class="line">        <span class="symbol">$</span>filters: &#123;&#125;,</div><div class="line">        <span class="symbol">$</span><span class="keyword">options</span>: &#123;&#125;,</div><div class="line">        <span class="symbol">$</span>filter(&#123;filters, <span class="keyword">options</span>, params&#125;) &#123;</div><div class="line">            <span class="comment">// modify filters and options don't override</span></div><div class="line">        &#125;</div><div class="line">        title: <span class="number">1</span>,,</div><div class="line">        nestedField: &#123; <span class="comment">// &#123;&#125; can be used for nested fields</span></div><div class="line">            nestedFieldItem: <span class="number">1</span></div><div class="line">        &#125;</div><div class="line">        comments: &#123;</div><div class="line">            <span class="symbol">$</span>filters: &#123;&#125;, <span class="comment">// will only be applied to linked elements</span></div><div class="line">            <span class="symbol">$</span><span class="keyword">options</span>: &#123;&#125;, <span class="comment">// will only be applied to linked elements</span></div><div class="line">            <span class="symbol">$</span>filter(&#123;filters, <span class="keyword">options</span>, params&#125;) &#123;</div><div class="line">                <span class="comment">// params is global at query level, so params here are the same as params from the parent</span></div><div class="line">            &#125;</div><div class="line">            linkField: <span class="number">1</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;, params)</div></pre></td></tr></table></figure>
<h2 id="Query-fetch"><a href="#Query-fetch" class="headerlink" title="Query.fetch()"></a>Query.fetch()</h2><figure class="highlight gcode"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// server-side</span></div><div class="line">query.fetch<span class="comment">()</span> </div><div class="line"></div><div class="line"><span class="comment">// impersonate user to work with exposure</span></div><div class="line">query.fetch<span class="comment">(&#123;userId: someUserId&#125;)</span></div></pre></td></tr></table></figure>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="regexp">//</span> client-side</div><div class="line">query.fetch(<span class="function"><span class="params">(err, data)</span> =&gt;</span> &#123;</div><div class="line">    <span class="regexp">//</span> <span class="keyword">do</span> something with data</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="Query-fetchOne"><a href="#Query-fetchOne" class="headerlink" title="Query.fetchOne()"></a>Query.fetchOne()</h2><p>Same as fetch() but it always returns one result. Works very well when you want to retrieve a single item.</p>
<h2 id="Query-setParams"><a href="#Query-setParams" class="headerlink" title="Query.setParams()"></a>Query.setParams()</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">query</span><span class="selector-class">.setParams</span>(<span class="selector-tag">params</span>)<span class="selector-class">.fetch</span>()</div></pre></td></tr></table></figure>
<h2 id="Query-subscribe"><a href="#Query-subscribe" class="headerlink" title="Query.subscribe()"></a>Query.subscribe()</h2><p>This will subscribe to the current query configuration. If you want to change parameters. You will call <em>setParams()</em>, then subscribe again. </p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// client-side</span></div><div class="line">query.subscribe<span class="comment">()</span>;</div><div class="line">query.fetch<span class="comment">()</span>; <span class="comment">// no callback needed, it will fetch from client-side collections</span></div></pre></td></tr></table></figure>
<h2 id="Query-unsubscribe"><a href="#Query-unsubscribe" class="headerlink" title="Query.unsubscribe()"></a>Query.unsubscribe()</h2><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// client-side</span></div><div class="line"><span class="selector-tag">query</span><span class="selector-class">.unsubscribe</span>();</div><div class="line"><span class="selector-tag">query</span><span class="selector-class">.fetch</span>(callback); <span class="comment">// this time it needs callback because the query is now unsubscribed</span></div></pre></td></tr></table></figure>
<h2 id="Query-clone"><a href="#Query-clone" class="headerlink" title="Query.clone()"></a>Query.clone()</h2><p>When you import your query, any changes you do to the parameters will stick. This is why it is recommended to clone it where you use it,
so it becomes isolated.</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">const usableQuery</span> = query.clone(newParameters);</div></pre></td></tr></table></figure>
<p>Another approach would be to export a factory function of createQuery like</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</div><div class="line">    <span class="keyword">return</span> createQuery(<span class="keyword">body</span>);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
    </div>
  </div>

  <div class="pagination">
    <div class="content-wrapper">
      
      
        <a class="link primary prev"
          href="links.html">
          <span class="icon-arrow-left-alt"></span>
          <span class="subtitle-pagination">Previous</span>
          Linking
        </a>
      
      
        <a class="link primary next"
          href="exposure.html">
          <span class="subtitle-pagination">Next</span>
          Exposure API
          <span class="icon-arrow-right-alt"></span>
        </a>
      
    </div>
  </div>

  <div class="github">
    <a class="link tertiary " href="https://github.com/cult-of-coders/grapher-docs/tree/master/source/api/query.md" target="_blank">
      <span class="icon-github"></span>Edit on GitHub</a>
  </div>

  
</div>

<script src="/script/smooth-scroll.min.js"></script>
<script src="/script/main.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

<script>
    
    // Google analytics
    ;
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-40568040-9', 'auto');
    ga('send', 'pageview');
    

    

    // search box
    
    ['desktop', 'mobile'].forEach(function (type) {
        var search = docsearch({
            apiKey: 'c6162b5842b0dc5f7af8c186fff8f5bb',
            indexName: 'grapher',
            inputSelector: '#' + type + '-search-input',
            autocompleteOptions: {
                dropdownMenuContainer: '.wrapper-' + type + '-search-results',
                debug: true
            },
            algoliaOptions: {
                hitsPerPage: 20
            }
        }).autocomplete;
        var sidebar = document.querySelector('.sidebar-content');
        search.on('autocomplete:opened', function () {
            sidebar.classList.add('searching');
        });
        search.on('autocomplete:closed', function () {
            sidebar.classList.remove('searching');
        });
        search.on('autocomplete:updated', function () {
            if (search.val() === '') {
                search.autocomplete.close();
            }
        });
    });
    

    
</script>
</body>
</html>
