<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <!-- Basic -->
    <title>Collection Links | Grapher Docs</title>
    <meta name="description" content="Managing Links (Relationships) between Mongo Collections easily">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="../images/favicon.png"
          sizes="16x16 32x32 64x64">

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://grapher.cultofcoders.com">
    <meta property="og:title" content="Collection Links | Grapher Docs">
    <meta property="og:description" content="Managing Links (Relationships) between Mongo Collections easily">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_image_large">
    <meta name="twitter:site" content="@culotfcoders">
    <meta name="twitter:title" content="Collection Links | Grapher Docs">
    <meta name="twitter:description" content="Managing Links (Relationships) between Mongo Collections easily">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content=""/>
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic'
          rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/style/style.css">
</head>
<body class="">


<div class="nav dark">
  <div class="nav-group">
    <div class="nav-item">
      <span class="js-sidebar-toggle show-mobile">
        <span class="icon-menu"></span>
      </span>
      <a class="logo show-desktop" href="http://www.cultofcoders.com" title="Grapher"  >
        <img src="../images/logo.png" alt="Grapher Docs"/>
        <span></span>
      </a>
    </div>
  </div>

  <div class="center-wrapper show-mobile">
    <img src="../images/logo.png" alt="Grapher Docs"/>
    <div></div>
  </div>

  <div class="nav-group right">
    
      <div class="nav-item show-mobile">
        <span class="js-search-toggle">
          <span class="icon-search"></span>
        </span>
      </div>
    
    
      <div class="nav-item show-desktop ">
        <a class="link" href="https://github.com/cult-of-coders/grapher" target=_new >
          <span>GitHub</span>
        </a>
      </div>
    
      <div class="nav-item show-desktop ">
        <a class="link" href="http://grapher-live.cultofcoders.com/grapher" target=_new >
          <span>Test Live</span>
        </a>
      </div>
    
  </div>

  
    <div class="nav-search">
      <div class="input-symbol">
        <input type="text" placeholder="Search " id="mobile-search-input"/>
        <span class="icon-search"></span>
      </div>

      <div class="nav-group right">
        <div class="nav-item">
          <span class="js-search-toggle">
            <span class="icon-close"></span>
          </span>
        </div>
      </div>

      <div class="wrapper-mobile-search-results"></div>
    </div>
  

</div>

<div class="sidebar">
  <div class="panel">
    <div class="panel-item">
      <a class="" href="http://www.cultofcoders.com" title="Grapher"  >
        <span>Grapher</span>
      </a>
    </div>
    
      <div class="panel-item "">
        <a class="" href="https://github.com/cult-of-coders/grapher" target=_new >
          <span>GitHub</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://grapher-live.cultofcoders.com/grapher" target=_new >
          <span>Test Live</span>
        </a>
      </div>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      <span class="title-sidebar">Grapher Docs</span>
      
    </div>

    
    <div class="wrapper-search">
      <div class="input-symbol small round">
        <input type="text" placeholder="Search " id="desktop-search-input" />
        <span class="icon-search"></span>
      </div>
      <div class="wrapper-desktop-search-results"></div>
    </div>

    

    <ul class="toc">
      
        <li>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="../index.html" class="sidebar-link ">
                  <span>Introducing to Grapher</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Guide</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc  current">
                <a href="" class="sidebar-link  current">
                  <span>Collection Links</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="query.html" class="sidebar-link ">
                  <span>Query</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="exposure.html" class="sidebar-link ">
                  <span>Exposure</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="namedQuery.html" class="sidebar-link ">
                  <span>Named Query</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Packages</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="../packages/live.html" class="sidebar-link ">
                  <span>Grapher Live</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../packages/boilerplate.html" class="sidebar-link ">
                  <span>Grapher Boilerplate</span>
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>
</div>

<div class="content">
  <div class="content-wrapper">
    <div class="header-content">
      <h1 class="title-page">Collection Links</h1>
      
        <div class="subtitle-page">Managing Links (Relationships) between Mongo Collections easily</div>
      

      <div class="page-actions">
        <div class="actions-group">
          <a class="btn primary small round lowercase" href="https://github.com/cult-of-coders/grapher-docs/tree/master/source/guide/links.md" target="_blank"><span class="icon-github"></span> <span>Edit on GitHub</span></a>
          
        </div>
      </div>
    </div>

    <div class="document-formatting">
      <h2 id="Our-First-Link"><a href="#Our-First-Link" class="headerlink" title="Our First Link"></a>Our First Link</h2><p>You have a Comment that is posted by an User. 
We either store userId at Comment level, or store commentIds at User level.
The second one doesn’t make much sense, so we’ll explore the first one.</p>
<p>If we store “userId” in Comment document. We have a “One” relationship.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// comment document would look like:</span></div><div class="line">&#123;</div><div class="line">    <span class="attr">_id</span>: <span class="string">'XXXXXXXXXXXXXXX'</span>,</div><div class="line">    <span class="attr">text</span>: <span class="string">'Hello Grapher!'</span>,</div><div class="line">    <span class="attr">userId</span>: <span class="string">'XXXXXXXXXXXXXXX'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>To create this kind of link we would do:
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> Users = Meteor.users;</div><div class="line"><span class="keyword">const</span> Comments = <span class="keyword">new</span> Mongo.Collection(<span class="string">'comments'</span>);</div><div class="line"></div><div class="line">Comments.addLinks(&#123;</div><div class="line">    <span class="attr">user</span>: &#123; <span class="comment">// user represents the link name, can be any name you wish</span></div><div class="line">        type: <span class="string">'one'</span>, <span class="comment">// we would have used 'many' if we wanted to store multiple user ids</span></div><div class="line">        collection: Users,</div><div class="line">        <span class="attr">field</span>: <span class="string">'userId'</span> <span class="comment">// optional, if not specified it will generate a specific field.</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>We will use the <em>getLink</em> method, which is an object that allows us to fetch, and modify the linked elements.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> commentId = Comments.insert(&#123;<span class="attr">text</span>: <span class="string">'Our first linked comment.'</span>&#125;);</div><div class="line"><span class="keyword">const</span> userLink = Comments.getLink(commentId, <span class="string">'user'</span>); <span class="comment">// we retrieve the link object for commentId and 'user'</span></div><div class="line"></div><div class="line"><span class="comment">// if you have the comment object with an _id, you can also do Comments.getLink(comment, 'user')</span></div><div class="line">userLink.set(<span class="keyword">this</span>.userId);  <span class="comment">// will update userId</span></div><div class="line">userLink.unset(); <span class="comment">// will make userId null</span></div><div class="line"></div><div class="line">userLink.fetch(); <span class="comment">// returns the user object, if it was a multi relationship it would have returned an array</span></div><div class="line">userLink.find(); <span class="comment">// returns a Mongo.Cursor, but if you run .fetch() on it will return an array regardless of the relationship type.</span></div><div class="line"></div><div class="line"><span class="comment">// set/unset makes an update immediately into the database, should be run server side.</span></div></pre></td></tr></table></figure>
<blockquote class="pullquote warning"><p>Removing/unsetting the link, will not affect the related document. If you want to remove it from the database, you will have to do it manually.</p>
</blockquote>
<h2 id="Inversed-Links"><a href="#Inversed-Links" class="headerlink" title="Inversed Links"></a>Inversed Links</h2><p>Read more advanced information: <a href="inversed_links.md">inversed_links.md</a></p>
<p>All good but I may want at the user level to fetch all my comments I posted. This is where we introduce the concept of <em>inversed links</em>.
An <em>inversed link</em> basically means that the information about the link is stored on the other side. In our case, in the Comment document.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Users.addLinks(&#123;</div><div class="line">    <span class="string">'comments'</span>: &#123;</div><div class="line">        <span class="attr">collection</span>: Comments,</div><div class="line">        <span class="attr">inversedBy</span>: <span class="string">'user'</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">let</span> comments = [];</div><div class="line"><span class="keyword">const</span> commentsLink = Users.getLink(<span class="keyword">this</span>.userId, <span class="string">'comments'</span>);</div><div class="line">comments = commentsLink.find().fetch()</div><div class="line"><span class="comment">// or</span></div><div class="line">comments = commentsLink.fetch()</div><div class="line"><span class="comment">// or filter your query even more using find(filters, options)</span></div><div class="line">comments = commentsLink.find(&#123;<span class="attr">text</span>: <span class="string">'Our first linked comment.'</span>&#125;, &#123;<span class="attr">limit</span>: <span class="number">10</span>&#125;).fetch()</div><div class="line"><span class="comment">// or</span></div><div class="line">comments = commentsLink.fetch(&#123;<span class="attr">text</span>: <span class="string">'Our first linked comment.'</span>&#125;, &#123;<span class="attr">limit</span>: <span class="number">10</span>&#125;)</div></pre></td></tr></table></figure>
<blockquote class="pullquote warning"><p>If you use filters when fetching from a link, the filters will be applied only for the linked documents.</p>
</blockquote>
<p>Now, let’s continue our journey and assume the comment might have different tags. 
So let’s use a <em>Many</em> relationship:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">Comments.addLinks(&#123;</div><div class="line">    <span class="attr">tags</span>: &#123;</div><div class="line">        <span class="attr">collection</span>: Tags,</div><div class="line">        <span class="attr">type</span>: <span class="string">'many'</span></div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">const</span> tagLink = Comments.getLink(commentId, <span class="string">'tags'</span>);</div><div class="line">tagLink.add(tagId);</div><div class="line">tagLink.add(tagObject); <span class="comment">// object must contain _id to be able to identify it, </span></div><div class="line"></div><div class="line"><span class="comment">// IMPORTANT: if the object does not contain _id, the object will be created in the database for you automatically</span></div><div class="line">tagLink.add(&#123;<span class="attr">name</span>: <span class="string">'New Tag'</span>&#125;) <span class="comment">// will create a tag document in Tags collection</span></div><div class="line"></div><div class="line"><span class="comment">// Also supports:</span></div><div class="line">tagLink.add([tagId1, tagId2]);</div><div class="line">tagLink.add([tagObject1, tagObject2]);</div><div class="line"></div><div class="line"><span class="comment">// Same arguments are supported by tagLink.remove(...)</span></div></pre></td></tr></table></figure>
<p>Keep in mind:
For single relationships <em>One</em> and <em>One Meta</em> we use set() and unset().
For many relationships <em>Many</em> and <em>Many Meta</em> we use add() and remove().</p>
<h4 id="Chain-commands-that-run-updates-easily"><a href="#Chain-commands-that-run-updates-easily" class="headerlink" title="Chain commands that run updates easily:"></a>Chain commands that run updates easily:</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">tagLink</span><span class="selector-class">.remove</span>(oldTagId)<span class="selector-class">.add</span>(newTagId);</div><div class="line"><span class="selector-tag">exampleLink</span><span class="selector-class">.set</span>(<span class="string">'XXX'</span>)<span class="selector-class">.unset</span>();</div></pre></td></tr></table></figure>
<h2 id="Meta-Links"><a href="#Meta-Links" class="headerlink" title="Meta Links"></a>Meta Links</h2><p>A meta relationship is very useful because you may need to store information <em>about the relationship</em>. 
Such as an user can belong to certain groups, but he is an admin only to some group</p>
<p>So instead of creating a separate collection for this, or poluting the groups document, we could use meta relationships.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Users.addLinks(&#123;</div><div class="line">    <span class="attr">groups</span>: &#123;</div><div class="line">        <span class="attr">type</span>: <span class="string">'many'</span></div><div class="line">        metadata: &#123;&#125; <span class="comment">// it is enough to specify metadata as an empty object to make it clear we are dealing with a meta relation</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">const</span> groupsLink = Users.getLink(userId, <span class="string">'groups'</span>);</div><div class="line">groupsLink.add(groupId, &#123;<span class="attr">isAdmin</span>: <span class="literal">true</span>&#125;);</div><div class="line"></div><div class="line"><span class="comment">// metadata getter</span></div><div class="line">groupsLink.metadata(groupId) <span class="comment">// returns &#123;isAdmin: true, _id: groupId&#125;&#125;</span></div><div class="line"><span class="comment">// metadata setter</span></div><div class="line">groupsLink.metadata(groupId, &#123;<span class="attr">isAdmin</span>: <span class="literal">false</span>&#125;) <span class="comment">// runs the update for you automatically</span></div></pre></td></tr></table></figure>
<p>The same principles apply to <em>One Meta</em> relationships, but you don’t need to specify the _id:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Users.addLinks(&#123;</div><div class="line">    <span class="attr">group</span>: &#123;<span class="attr">type</span>: <span class="string">'one'</span>, <span class="attr">metadata</span>: &#123;&#125;&#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">const</span> groupLink = Users.getLink(userId, <span class="string">'group'</span>);</div><div class="line">groupLink.set(groupId, &#123;<span class="attr">isAdmin</span>: <span class="literal">true</span>&#125;);</div><div class="line">groupLink.metadata() <span class="comment">// returns &#123;isAdmin: true, _id: groupId&#125;&#125;</span></div><div class="line">groupLink.metadata(&#123;<span class="attr">isAdmin</span>: <span class="literal">false</span>&#125;) <span class="comment">// runs the update in the database.</span></div></pre></td></tr></table></figure>
<h2 id="Link-Looping-to-the-same-Collection"><a href="#Link-Looping-to-the-same-Collection" class="headerlink" title="Link Looping to the same Collection"></a>Link Looping to the same Collection</h2><p>For tree-like database structures this is great.
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">Users</span><span class="selector-class">.addLinks</span>(&#123;</div><div class="line">    <span class="attribute">children</span>: &#123;</div><div class="line">        collection: Users,</div><div class="line">        type: <span class="string">'many'</span></div><div class="line">    &#125;</div><div class="line">    <span class="selector-tag">parent</span>: &#123;</div><div class="line">        <span class="attribute">collection</span>: Users,</div><div class="line">        inversedBy: <span class="string">'children'</span></div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">const childrenLink = Users.getLink(this.userId, 'children');</div><div class="line">childrenLink.fetch() //<span class="built_in"> array </span>of ob<span class="built_in"></span></div><div class="line">const parentLink = Users.getLink(this.userId, 'children');</div><div class="line">parentLink.fetch() // single object</div></pre></td></tr></table></figure>
<h2 id="Resolver-Links"><a href="#Resolver-Links" class="headerlink" title="Resolver Links"></a>Resolver Links</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Users.addLinks(&#123;</div><div class="line">    <span class="attr">tickets</span>: &#123;</div><div class="line">        resolver(user, arg1, arg2) &#123; <span class="comment">// first argument will be the parent, next arguments are what is passed in fetch() or find()</span></div><div class="line">            <span class="keyword">const</span> runner = Meteor.wrapAsync(HTTP.call);</div><div class="line">            <span class="keyword">return</span> runner(<span class="string">"GET"</span>, <span class="string">"https://api.example.com/tickets"</span>, &#123;<span class="attr">id</span>: user.exampleApiId&#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">const</span> ticketLink = Users.getLink(<span class="keyword">this</span>.userId, <span class="string">'tickets'</span>);</div><div class="line">ticketsLink.fetch(arg1, arg2);</div><div class="line">ticketsLink.find(arg1, arg2); <span class="comment">// fetch() and find() they are equivalent for Resolver Links</span></div></pre></td></tr></table></figure>
<blockquote class="pullquote warning"><p>You must use a sync function for this to work. Read more about <a href="https://docs.meteor.com/api/core.html#Meteor-wrapAsync">Meteor.wrapAsync</a>.</p>
</blockquote>
<blockquote class="pullquote info"><p>You can also use resolver for special database queries for example, you may need to get only the messages that he has not seen yet.</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Users.addLinks(&#123;</div><div class="line">    <span class="attr">unreadMessages</span>: &#123;</div><div class="line">        resolver(user) &#123;</div><div class="line">            <span class="keyword">return</span> Messages.find(&#123;<span class="attr">receiverId</span>: user._id, <span class="attr">isRead</span>: <span class="literal">false</span>&#125;).fetch();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="Integration-with-SimpleSchema"><a href="#Integration-with-SimpleSchema" class="headerlink" title="Integration with SimpleSchema"></a>Integration with SimpleSchema</h2><p>It is very likely that you would use SimpleSchema to ensure a data-structure for your documents, and prevent bad data to be inserted.
This library automatically detects whether you have a schema attached to your collection or not, and will add fields with proper schema definitions.</p>
<p>IMPORTANT! In order for this to work without problems, make sure your schema is attached before defining links. These are the appended schemas by link type.</p>
<h4 id="One-Relationships"><a href="#One-Relationships" class="headerlink" title="One Relationships"></a>One Relationships</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">fieldName</span>: &#123;</div><div class="line">    <span class="attribute">type</span>: String,</div><div class="line">    optional: true</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Many-Relationships"><a href="#Many-Relationships" class="headerlink" title="Many Relationships"></a>Many Relationships</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">fieldName</span>: &#123;</div><div class="line">    <span class="attribute">type</span>: [String], </div><div class="line">    optional: true</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Meta-Relationships"><a href="#Meta-Relationships" class="headerlink" title="Meta Relationships"></a>Meta Relationships</h4><p>For meta relationships, it creates a blackbox schema if the metadata option contains no keys</p>
<p>Example:
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">Users</span><span class="selector-class">.addLinks</span>(&#123;</div><div class="line">    <span class="attribute">group</span>: &#123;</div><div class="line">        <span class="attribute">type</span>: <span class="string">'one'</span>, </div><div class="line">        <span class="attribute">field</span>: <span class="string">'groupId'</span>,</div><div class="line">        <span class="attribute">metadata</span>: &#123;&#125;</div><div class="line">     &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>This will append to your schema:
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="attr">groupId:</span> &#123;</div><div class="line"><span class="attr">    type:</span> Object,</div><div class="line"><span class="attr">    blackbox:</span> <span class="literal">true</span>, </div><div class="line"><span class="attr">    optional:</span> <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Example:
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">Users</span><span class="selector-class">.addLinks</span>(&#123;</div><div class="line">    <span class="attribute">group</span>: &#123;</div><div class="line">        <span class="attribute">type</span>: <span class="string">'one'</span>, </div><div class="line">        <span class="attribute">field</span>: <span class="string">'groupId'</span>,</div><div class="line">        <span class="attribute">metadata</span>: &#123;</div><div class="line">            <span class="attribute">isAdmin</span>: &#123;<span class="attribute">type</span>: Boolean, <span class="attribute">optional</span>: true&#125;</div><div class="line">        &#125;</div><div class="line">     &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>This will append to your schema:
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">groupId: &#123;</div><div class="line">    <span class="keyword">type</span>: <span class="built_in">Object</span>,</div><div class="line">    blackbox: <span class="literal">true</span>, </div><div class="line">    optional: <span class="literal">true</span></div><div class="line">&#125;</div><div class="line">groupId.$._id: &#123;<span class="keyword">type</span>: <span class="built_in">String</span>&#125;</div><div class="line">groupId.$.isAdmin: &#123;<span class="keyword">type</span>: <span class="built_in">Boolean</span>, optional: <span class="literal">true</span>&#125;</div></pre></td></tr></table></figure></p>
<blockquote class="pullquote warning"><p>_id field is put by default.</p>
</blockquote>
<p>If you have a many meta relationship:
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> metadataSchema = &#123;</div><div class="line">    _id: &#123;<span class="keyword">type</span>: <span class="built_in">String</span>&#125;,</div><div class="line">    isAdmin: &#123;<span class="keyword">type</span>: <span class="built_in">Boolean</span>, optional: <span class="literal">true</span>&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Appended schema will look like:
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">groupIds</span>: &#123;</div><div class="line">    <span class="attribute">type</span>: [metadataSchema],</div><div class="line">    optional: true</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Data-Consistency"><a href="#Data-Consistency" class="headerlink" title="Data Consistency"></a>Data Consistency</h2><p>Let’s say I have a “Thread” with multiple “Members”. If a “Member” is deleted from the database, we don’t want to keep unexisting references.
This is why if we delete a member, thread document should be cleaned.</p>
<blockquote class="pullquote warning"><p>This works for any kind of relationship.</p>
</blockquote>
<p>This is achieved by using <a href="https://atmospherejs.com/matb33/collection-hooks" target="_blank" rel="external">https://atmospherejs.com/matb33/collection-hooks</a> package.
And it only works if Member contains the inversed link to Thread.</p>
<p>Let’s see how that works’</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Threads.addLinks(&#123;</div><div class="line">    <span class="string">'members'</span>: &#123;</div><div class="line">        collection: Members,</div><div class="line">        type: <span class="string">'many'</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">Members.addLinks(&#123;</div><div class="line">    <span class="string">'threads'</span>: &#123;</div><div class="line">        collection: Threads,</div><div class="line">        inversedBy: <span class="string">'members'</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>When <em>Member</em> is removed from the database, it will look for all the threads of that member.
And it will remove it from the fieldStorage. This way your data will be <em>consistent</em> without having to deal with it.</p>
<h2 id="Autoremoval"><a href="#Autoremoval" class="headerlink" title="Autoremoval"></a>Autoremoval</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="type">Members</span>.addLinks(&#123;</div><div class="line">    <span class="symbol">'post</span>s': &#123;</div><div class="line">        collection: <span class="type">Posts</span>,</div><div class="line">        <span class="class"><span class="keyword">type</span></span>: <span class="symbol">'man</span>y',</div><div class="line">        autoremove: <span class="literal">true</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Be careful with this one! 
When Member document is deleted, all posts will be deleted.</p>
<h2 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="type">Members</span>.addLinks(&#123;</div><div class="line">    <span class="symbol">'post</span>s': &#123;</div><div class="line">        collection: <span class="type">Posts</span>,</div><div class="line">        <span class="class"><span class="keyword">type</span></span>: <span class="symbol">'man</span>y',</div><div class="line">        index: <span class="literal">true</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<blockquote class="pullquote warning"><p>By using <em>index: true</em> option, it will call _ensureIndex automatically on your collection.
This will give you a performance boost when you are searching from the “related” link, in our case, from “Posts”.</p>
</blockquote>

    </div>
  </div>

  <div class="pagination">
    <div class="content-wrapper">
      
      
        <a class="link primary prev"
          href="../index.html">
          <span class="icon-arrow-left-alt"></span>
          <span class="subtitle-pagination">Previous</span>
          Introducing to Grapher
        </a>
      
      
        <a class="link primary next"
          href="query.html">
          <span class="subtitle-pagination">Next</span>
          Query
          <span class="icon-arrow-right-alt"></span>
        </a>
      
    </div>
  </div>

  <div class="github">
    <a class="link tertiary " href="https://github.com/cult-of-coders/grapher-docs/tree/master/source/guide/links.md" target="_blank">
      <span class="icon-github"></span>Edit on GitHub</a>
  </div>

  
</div>

<script src="/script/smooth-scroll.min.js"></script>
<script src="/script/main.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

<script>
    
    // Google analytics
    ;
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-40568040-9', 'auto');
    ga('send', 'pageview');
    

    

    // search box
    
    ['desktop', 'mobile'].forEach(function (type) {
        var search = docsearch({
            apiKey: 'c6162b5842b0dc5f7af8c186fff8f5bb',
            indexName: 'grapher',
            inputSelector: '#' + type + '-search-input',
            autocompleteOptions: {
                dropdownMenuContainer: '.wrapper-' + type + '-search-results',
                debug: true
            },
            algoliaOptions: {
                hitsPerPage: 20
            }
        }).autocomplete;
        var sidebar = document.querySelector('.sidebar-content');
        search.on('autocomplete:opened', function () {
            sidebar.classList.add('searching');
        });
        search.on('autocomplete:closed', function () {
            sidebar.classList.remove('searching');
        });
        search.on('autocomplete:updated', function () {
            if (search.val() === '') {
                search.autocomplete.close();
            }
        });
    });
    

    
</script>
</body>
</html>
